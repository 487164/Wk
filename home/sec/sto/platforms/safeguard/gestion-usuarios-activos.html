<!--
title: Gestión de Usuarios y Activos
description: 
published: true
date: 2024-02-27T11:05:29.263Z
tags: 
editor: ckeditor
dateCreated: 2024-02-22T14:20:44.839Z
-->

<h1 style="text-align:center;">Gestión de Usuarios y Activos</h1>
<p>&nbsp;</p>
<p style="text-align:center;">&nbsp;</p>
<p style="text-align:center;"><mark class="marker-yellow">En desarrollo, preguntar @ralfaro</mark></p>
<h2>Crear Activos</h2>
<p>Se ha tenido que preparar antes la máquina siguiendo las instrucciones de:</p>
<ul>
  <li><a href="https://wiki.security.espublico.com/es/home/sec/sto/platforms/safeguard/preparacion-maquina-windows">Preparación de máquina windows</a></li>
  <li>Preparación de máquina linux <mark class="marker-yellow">(Pendiente, por ahora solo se ha previsto crear jump)</mark></li>
</ul>
<p>En <a href="https://zgz-pam-pass.zaragoza.espublico.it/">Safeguard for Privileged Passwords</a> (<strong>SPP)&nbsp;</strong> <a href="https://zgz-pam-pass.zaragoza.espublico.it/asset-management/assets">Asset Management&gt;Assets</a> se añade la máquina que se va a gestionar:</p>
<p>&nbsp;</p>
<h3>Windows, servidor independiente o miembro de dominio</h3>
<p>En la pestaña General</p>
<ul>
  <li>Name: El registro A del DNS de la ip de la interfaz a utilizar (p.ej: itx-sec-poc-gestionaapps-03-mgmt.madrid.espublico.com)</li>
  <li>Description: El hostname y el cname de la máquina si lo tienen y no son parte del registro A (p.ej. WIN-28CM0AEJLRT ya que a esta máquina no se le ha cambiado el hostname y no tiene cname)</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/general.jpg"></figure>
<p>En la pestaña Connection</p>
<ul>
  <li>Platform: Windows Server</li>
  <li>Network Address: IP de la interfaz a utilizar (si tiene más de una, se ha debido configurar el servidor para permitir la conexión la interfaz de mgmt)</li>
  <li>Authentication Type: Password</li>
  <li>Service Account Name: aCdCmN570</li>
  <li>Password: Teampass (Entrada: Seguridad&gt;PAM&gt;Windows default password #80287)</li>
  <li>Click en Test Connection, para comprobar que la cuenta de servicio puede gestionar cuentas en el equipo.</li>
  <li>Click en OK para guardar</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/connection.jpg"></figure>
<p>En la pestaña Accounts</p>
<ul>
  <li>Doble click en la cuenta aCdCmN570 que estará ya creada, pero solo como Service Account.</li>
  <li>Se abre la ventana de la cuenta<ul>
      <li>Click en Properties<ul>
          <li>Click en Management</li>
          <li>Click en el icono del lapiz para editar</li>
          <li>Marcar Enable Session Request para indicar que esa cuenta será también utilizada para conectar por RDP</li>
          <li>Click en OK</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/management.jpg"></figure>
<ul>
  <li>Click en Account Security asegurandose de seguir en la ventana de la cuenta, pestaña de Properties.<ul>
      <li>Click en Change Password para cambiar la contraseña por defecto.</li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/testchange.jpg"></figure>
<ul>
  <li>Click en Access Request Policies, asegurandose de seguir en la ventana de la cuenta<ul>
      <li>Click en el icono de +</li>
      <li>Buscar y añadir la Access Request Policy que del grupo de usarios que deba tener acceso al servidor. Incialmente:<ul>
          <li>Sysadmin Group Access Request.</li>
          <li>Security &nbsp;Group Access Request.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/accessrequest.jpg"></figure>
<p>&nbsp;</p>
<h3>Windows, Controlador de Domino</h3>
<p>En la pestaña General</p>
<ul>
  <li>Name: El nombre dominio del Active Directory cuyas cuentas se van a gestionar (p.ej: testens.es)</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azgeneral.jpg"></figure>
<p>En la pestaña Connection</p>
<ul>
  <li>Platform: Active Directory</li>
  <li>Domain name: El nombre dominio del Active Directory cuyas cuentas se van a gestionar (p.ej: testens.es)</li>
  <li>Domain controllers: IP de la interfaz a utilizar (si tiene más de una, se ha debido configurar el servidor para permitir la conexión la interfaz de mgmt)</li>
  <li>Service Account Name: aCdCmN570srv</li>
  <li>Password: Teampass (Entrada: Seguridad&gt;PAM&gt;Windows default password #80287)</li>
  <li>Desmarcar Use SSL Encryption</li>
  <li>Click en Test Connection, para comprobar que la cuenta de servicio puede gestionar cuentas en el equipo.</li>
  <li>Click en OK para guardar</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azconnection.jpg"></figure>
<p>En la pestaña Accounts</p>
<ul>
  <li>Click en + (new account)<ul>
      <li>Aparece la página de New Account, click en Select Account<ul>
          <li>Aparece la página de Account Search Options, en Starts With (Active Directory ANR Search) escribir: aCdCmN570 y click en Find Account<ul>
              <li>Aparece la página Select Account, elegir la cuenta aCdCmN570 y hacer click en Select Account.</li>
            </ul>
          </li>
        </ul>
      </li>
      <li>Vuelve a la página de New Account, hacer click en OK</li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azaddaccount.jpg"></figure>
<ul>
  <li>Aparece la ventana de la cuenta aCdCmN570 en la pestaña de Properties<ul>
      <li>Click en Management</li>
      <li>Click en el icono del lapiz para editar</li>
      <li>Desmarcar Enable Password Request y dejar marcado Enable Session Request para indicar que esa cuenta será unicamente utilizada para conectar por RDP</li>
      <li>Click en OK y cerrar</li>
    </ul>
  </li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azenablerequest.jpg"></figure>
<ul>
  <li>Aparece la ventana del Asset del dominio que estamos creando, click en Accounts (2)</li>
  <li>Seleccionar ambas cuentas</li>
  <li>Click en el icono de Account Security</li>
  <li>Click en Change Password para &nbsp;para cambiar la contraseña por defecto.</li>
  <li>Una vez hecho el cambio click la X de la esquina superior derecha para volver a Asset Management&gt;Assets</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azrotar.jpg"></figure>
<p>&nbsp;</p>
<p>Se añade el Asset del DC. En la pestaña General</p>
<ul>
  <li>Name: El registro A del DNS de la ip de la interfaz a utilizar (p.ej: itx-sec-poc-gestionaapps-01-mgmt.madrid.espublico.com)</li>
  <li>Description: El dominio\hostname y el cname de la máquina si lo tienen y no son parte del registro A (p.ej. testens.es\itx-sec-poc-01 ya que a esta máquina no le coindice el hostname con el registro A y no tiene cname)</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azassetgeneral.jpg"></figure>
<p>En la pestaña Connection</p>
<ul>
  <li>Platform: Windows Server</li>
  <li>Network Address: IP de la interfaz a utilizar (si tiene más de una, se ha debido configurar el servidor para permitir la conexión la interfaz de mgmt)</li>
  <li>Authentication Type: None. Es necesario crearle una request solo para los DC donde se asignarán las cuentas de servicio de Azure y la de usuario de RDP, en el siguiente paso.</li>
  <li>Click en OK para guardar</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/azassetconnection.jpg"></figure>
<p>En Security <a href="https://zgz-pam-pass.zaragoza.espublico.it/security-policy-management/entitlements">Policy Management &gt; Entitlements</a> &nbsp;elegir la Access Request Policy que del grupo de usarios que deba tener acceso al servidor. Incialmente:</p>
<ul>
  <li>Sysadmin Group Access Request.</li>
  <li>Security &nbsp;Group Access Request.</li>
</ul>
<p>En la pesaña Acces Request Policies hacer click en + (New Access Policy). Se abre Create Access Request Policy</p>
<p>En la pestaña General</p>
<ul>
  <li>Name: [dominio] Group Access Request (por ejemplo &nbsp;testens.es Group Access Request)</li>
  <li>Choose Request Policy Type: Session</li>
  <li>Choose Session Type: RPD</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/requestname.jpg"></figure>
<p>En la pestaña Security</p>
<ul>
  <li>Dejar marcado Change Password After Check-In, Change SSH Key After Check-In</li>
  <li>No marcar Allow Simultaneus Access si no es necesario, ya que acumulará tareas de rotación de contraseña si hay check-ins simultaneos</li>
  <li>En Asset-Bassed Session Access, click Directory Account, click en browse y elegir la cuenta aCdCmN570srv del dominio</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/requestsecurity.jpg"></figure>
<p>En la pestaña Scope</p>
<ul>
  <li>Click en +</li>
  <li>Click en Add an asset to this policy</li>
  <li>Elegir el Asset del DC que se acaba de crear</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/requestscope.jpg"></figure>
<p>En la pestaña Workflow</p>
<ul>
  <li>Click en Requester y marcar Allos Requester to Change Duration dejando el Maximun Time Requester Can Have Access en 7 Days</li>
  <li>En Approver dejar Auto-approved, el valor por defecto</li>
  <li>En Reviewer dejar Review Not Required, el valor por defecto</li>
  <li>Click en Apply &amp; Close</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/requestworkflow.jpg"></figure>
<p>Volverá a la página de la [Security/Sysadmin] Group Windows Entitlement Click en Save &amp; Close para guardar la Acces Policy que se acaba de crear.</p>
<p>&nbsp;</p>
<h2>Creación de Usuarios</h2>
<p>Se debe asignar a los usuarios un Id de empleado en el Tennant de esPublico.it y revisar si es necesario añadirlo a los grupos de GF_PAM_xxx</p>
<p>En User <a href="https://zgz-pam-pass.zaragoza.espublico.it/user-management/users">Management&gt;Users</a> click en + (New User), en la pestaña Properties&gt;Identity</p>
<ul>
  <li>Identity Provider: Local</li>
  <li>Username: El nombre de usuario que usa en el resto de aplicaciones, correo… (por defect inicial del nombre y primer apellido)</li>
  <li>Name: Nombre como aparece en la intranet</li>
  <li>Last Name: Apellidos como aparecen en la intranet</li>
  <li>Email: email corporativo</li>
  <li>TimeZone: Madrid</li>
</ul>
<p>Pulsar Next para ir a la pestaña Properties&gt;Authentication</p>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/newuseridentity.jpg"></figure>
<p>En la pestaña Properties&gt;Authentication</p>
<ul>
  <li>Authentication Provider: Local</li>
  <li>Login Name: El nombre de usuario que usa en el resto de aplicaciones, correo… (por defect inicial del nombre y primer apellido)</li>
  <li>Contraseña: Establecer una contraseña aleatoria que cumpla los requisitos</li>
  <li>Marcar: User Must Change Password at Next Login y Require Secundary Authentication y seleccionar yubikey</li>
  <li>Pulsar OK para crear el usuario y volver a la pestaña de Properties&gt;Identity</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/newuserauth.jpg"></figure>
<p>Ir a la pestaña User Groups y añadir al grupo de usuarios al que pertenezca y cerrar del aspa superior derecha.</p>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/newusergroup.jpg"></figure>
<p>&nbsp;</p>
<p>En <a href="https://zgz-pam-pass.zaragoza.espublico.it/security-policy-management/entitlements">Security Policy Management&gt;Entitlements</a> crear 1 un nuevo Entitlement</p>
<ul>
  <li>Click en + (New Entitlement)</li>
  <li>Name: el id de empleado del tennant de esPublico.it (tendrá formato 50nn por defecto)</li>
  <li>Click en Save &amp; Close para crearlo y ir a la pestaña de Access Request Policies</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/newentitlement.jpg"></figure>
<p>En la pestaña de Access Request Policies no se van a asignar aún policies. Hacer click en Users para cambiar de pestaña y asignar el entitlement al usuario recien creado.</p>
<ul>
  <li>+ (Add Users or Groups to this Entitlement) y elegir al usuario</li>
  <li>Save &amp; Close</li>
</ul>
<figure class="image"><img src="/sec/sto/platforms/safeguard/gestion-usuarios-activos/newentitlementuser.jpg"></figure>
<p>En Asset Management&gt;Accounts crear las 3 cuentas para las máquinas de tools de interxion, nabiax y zaragoza y asignarlas a los assets de las máquinas de salto.</p>
<p>&nbsp;</p>
<p>Crear su propio entitlement, las cuentas i50xx, z50xx y n50xx, asignarlas a los assets de jump, al grupo de accounts de jump y las cuentas que puede consultar la API</p>
