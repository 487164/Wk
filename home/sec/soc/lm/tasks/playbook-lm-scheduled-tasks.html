<!--
title: Playbook LM Scheduled Tasks
description: 
published: true
date: 2024-02-06T07:45:13.568Z
tags: soc, lm, task, playbook, scheduled
editor: ckeditor
dateCreated: 2024-01-16T10:24:11.049Z
-->

<h1 style="text-align:center;"><strong>Playbook LM Scheduled Tasks</strong></h1>
<p>&nbsp;</p>
<h2>Descripción</h2>
<p>A continuación se detallan la lista de tareas y acciones a tomar durante su realización.</p>
<p>&nbsp;</p>
<h2>Control de tareas</h2>
<p>El control de tareas se llevará a cabo mediante el documento: <a href="https://docs.google.com/spreadsheets/u/0/d/1jS9n71gsRnmFtSDLGiUe8AcA5UoQfh7PVoH7t4GYU-o/edit"><u>Control de tareas</u></a></p>
<p>El documento se estructura de la siguiente forma:</p>
<ul>
  <li>Task: Desglose de las tareas y su información.</li>
  <li>Daily: Estado de las tareas diarias.</li>
  <li>Daily Operator: Identifica el operador que ha realizado la tarea.</li>
  <li>Weekly: Estado de las tareas semanales.</li>
  <li>Weekly Operator: Identifica el operador que ha realizado la tarea.</li>
  <li>Monthly: Estado de las tareas mensuales.</li>
  <li>Monthly Operator: Identifica el operador que ha realizado la tarea.</li>
  <li>Quarterly: Estado de las tareas trimestrales</li>
  <li>Quarterly Operator: Identifica el operador que ha realizado la tarea.</li>
  <li>Semester: Estado de las tareas semestrales</li>
  <li>Semester Operator: Identifica el operador que ha realizado la tarea.</li>
</ul>
<p>&nbsp;</p>
<h2>Estado de tarea</h2>
<p>Las tareas pueden tener 3 estados:</p>
<ul>
  <li>OK: la tarea se ha realizado y no ha sido necesaria ninguna tarea relacionada.</li>
  <li>NOK: la tarea se ha realizado y ha sido necesario iniciar una tarea relacionada.</li>
  <li>INACTIVA: solo para aquellas tareas que se identifican como inactiva en la hoja “Task”.</li>
</ul>
<p style="text-align:justify;">&nbsp;</p>
<h2>Data Lake Health</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p style="text-align:justify;">Revisión del estado de los servidores de data lake para garantizar que no hay errores durante el proceso de almacenamiento y cifrado de los logs.</p>
<p style="text-align:justify;">Revisión en la recepción de correos de sincronización por cada localización en el correo del SOC.</p>
<p style="text-align:justify;">&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Diaria</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>15 min</p>
<p>&nbsp;</p>
<h3><strong>Servidores</strong></h3>
<p style="text-align:justify;">La revisión se deberá realizar en los siguientes servidores:</p>
<ul>
  <li>zgz-data-lake-svcs.zaragoza.espublico.com</li>
  <li>nbx-data-lake-svcs.madrid.espublico.com</li>
  <li>itx-data-lake-svcs.madrid.espublico.com</li>
  <li>dpz.c-security.espublico.com</li>
</ul>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p style="text-align:justify;">Identificar en correo que los correos con el asunto “XXX-data-lake - S3 sync daily” donde XXX corresponderá a la localización han llegado. Se deberá revisar que en el correo no aparecen errores de sincronización de ficheros y que se han subido los mismos (debería ser un número más o menos similar cada día en función del servidor).</p>
<p style="text-align:justify;">En caso de disponer de acceso ssh a la consola se deberán revisar además los siguientes puntos:</p>
<ul>
  <li style="text-align:justify;">Revisión del estado de la compresión y cifrado de logs.</li>
  <li style="text-align:justify;">Revisión de la sincronización de ficheros con el bucket S3. (se puede ver el resultado en los correos anteriores)</li>
  <li style="text-align:justify;">Revisión de directorios erróneos creados en el reenvío de logs desde QRadar.</li>
</ul>
<p style="text-align:justify;">Se explican las acciones a realizar en el documento <a href="https://wiki.security.espublico.com/es/home/sec/soc/lm/procedures/revision-servidores-data-lake"><u>Revisión servidores data lake</u></a></p>
<p style="text-align:justify;">&nbsp;</p>
<p style="text-align:justify;">En caso de errores, abrir ticket si es necesario con el tag INC explicando el problema y las acciones llevadas a cabo para su resolución.</p>
<p>&nbsp;</p>
<h2>SIEM Log Sources</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar si existen eventos sin una fuente de log asignada y crearla si procede.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Diaria&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>15 min</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Servidor SIEM de Producción</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Revisar los logs sources filtrando por el <strong>Log Source Type “SIM Generic Log DSM”</strong> de cada uno de los event collectors y revisar si hay algún servidor enviando logs que no disponga de un log source configurado.</p>
<p>En caso de que algún servidor haya mandado al colector correspondiente, revisar si este mismo necesita de la creación de fuentes adicionales siguiendo la guía de <a href="https://wiki.security.espublico.com/es/home/sec/soc/lm/procedures/anadir-log-source">creación</a></p>
<p>Como punto importante, el orden de creación de las fuentes ya que es como se van procesar los eventos, de manera que si el orden es incorrecto, eventos de una fuente , pueden al final acabar en otra.</p>
<p>&nbsp;</p>
<p>En caso de errores, abrir ticket si es necesario con el tag <strong>NLS </strong>explicando el problema y las acciones llevadas a cabo para su resolución.</p>
<p>&nbsp;</p>
<h2>SIEM Auto Updates</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar el estado de las actualizaciones automáticas que se han ejecutado durante la madrugada.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Diaria</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5-60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Revisar en las notificaciones del sistema el estado de la última actualización automática.</p>
<p>En caso de que la misma se haya completado correctamente aparecerá una notificación con un texto similar al siguiente:</p>
<p>“Automatic updates completed successfully. “</p>
<p>En caso de que se muestre algún error, revisar el documento <a href="https://wiki.security.espublico.com/es/home/sec/sto/platforms/ibm-qradar/procedures/revision-errores-auto-updates"><u>Revisión errores auto-updates</u></a> para saber cómo proceder.</p>
<p>En caso de errores, abrir ticket si es necesario con el tag INC explicando el problema y las acciones llevadas a cabo para su resolución.</p>
<p>&nbsp;</p>
<h2>SIEM Notifications</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Se deberán revisar las notificaciones existentes desde la GUI web de QRadar.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Diaria&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5-60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Las notificaciones las podremos ver desde el el dashboard principal o desde Log Sources en <strong>System Notification-2 :: itx-qradar-cs-01 </strong>si necesitamos ver de modo histórico.</p>
<p>Revisar el documento <a href="https://wiki.security.espublico.com/es/home/sec/sto/platforms/ibm-qradar/procedures/system-notifications">System Notifications</a>&nbsp;donde hay explicaciónes de las distintas notificaciones y actuar en función de las mismas.</p>
<p>&nbsp;</p>
<h3>&nbsp;</h3>
<h2>SOAR Health</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar el estado de recursos del servidor itx-soar-01-svcs</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Diaria</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>10 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Servidores:</p>
<ul>
  <li>itx-soar-01-svcs.madrid.espublico.com</li>
</ul>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Revisar el estado de los recursos del servidor del soar, CPU, memoria, procesos con el fin de identificar si existe algún problema en el mismo o en la ejecución de alguna de las APIs existentes en el mismo.</p>
<p>Revisar el estado de los procesos y que no se hayan quedado lockfiles por error.</p>
<p>Se ha generado un script para la revisión de estas tareas, ejecutar con el siguiente comando:</p>
<pre><code class="language-plaintext">sudo /opt/scripts/soar/soar-checks.sh</code></pre>
<p>A continuación se ve un ejemplo de su ejecución:</p>
<pre><code class="language-plaintext">sudo /opt/scripts/soar/soar-checks.sh 
[*] Checking CPU...
 08:42:15 up 17 days, 19:02,  1 user,  load average: 0,26, 0,25, 0,26

[*] Checking memory...
               total        used        free      shared  buff/cache   available
Mem:           7,4Gi       1,4Gi       1,4Gi       146Mi       5,0Gi       6,0Gi
Swap:          2,0Gi        18Mi       2,0Gi

[*] Checking lock files...
total 0

[*] Checking running processes...
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         963  0.0  0.1  24460 14976 ?        Ss   ene19   6:14 /usr/sbin/snmpd -LSwd -Lf /dev/null -p /var/run/snmpd.pid -M +/opt/hp/mibs -m +ALL --v1trapaddress=192.168.213.12 -f
root         970  0.0  0.1  22984 11296 ?        Ss   ene19   0:35 /usr/sbin/snmptrapd -LSwd -Lf /dev/null -p /var/run/snmptrapd.pid -M +/opt/hp/mibs -m +ALL -f
root     4080027  0.0  0.0  10028  3200 ?        Ss   08:42   0:00 /bin/sh -c /opt/espublico/Security-monitoring/qradar/qradar2mysql/qradar2mysql.py -uq &gt; /dev/null 2&gt;&amp;1
root     4080033 33.3  0.7 139464 56212 ?        R    08:42   0:04 python3 /opt/espublico/Security-monitoring/qradar/qradar2mysql/qradar2mysql.py -uq

[*] Checking disks...
Filesystem                   Size  Used Avail Use% Mounted on
/dev/mapper/rocky-root        17G  6,5G   11G  38% /
/dev/mapper/vg_data-lv_data   20G   11G  9,3G  54% /data
</code></pre>
<p>&nbsp;</p>
<p><strong>[*] Checking CPU...</strong></p>
<p>- 13:06:35 up 154 days 1:04 → Tiempo que el servidor ha estado funcionando.</p>
<p>- 4 users → Numero de usuarios conectados</p>
<p>- Load average: 0,75, 0,49, 0,32 → Promedio de carga en el sistema en 1 / 5 / 15 minutos.</p>
<p>&nbsp;</p>
<p><strong>[*] Checking Memory...</strong></p>
<p>- Total → Total de memoria en el sistema.</p>
<p>- Used → Memoria ya usada por el sistema.</p>
<p>- Free → Memoria libre</p>
<p>- Available → Memoria en uso pero que puede ser usada en otros procesos.</p>
<p>&nbsp;</p>
<p><strong>[*] Checking Lock Files...</strong></p>
<p>- Nos muestra los ficheros creados cuando una aplicacion del soar esta siendo ejecutada.</p>
<p>&nbsp;</p>
<p><strong>[*] Checking running process...</strong></p>
<p>- Procesos del sistema en ejecución</p>
<p>&nbsp;</p>
<p><strong>[*] Checking Disks...</strong></p>
<p>- /dev/mapper/rocky-root → nombre del sistema (en este ejemplo del volumen lógico)</p>
<p>- 17G → Tamaño total del disco</p>
<p>- 6G → Tamaño usado del disco</p>
<p>- 12 → Tamaño libre del disco</p>
<p>- 35% → Porcentaje usado</p>
<p>- / → Punto de montaje</p>
<p>&nbsp;</p>
<h2>SIEM APP Updates</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar si existen actualizaciones pendientes de aplicar en alguna de las aplicaciones instaladas en QRadar.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5-60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Se deberá acceder a la aplicación de IBM QRadar Assistant y revisar que no hay actualizaciones pendientes, en caso de haberlas, se deberá abrir un ticket con el tag <strong>APP_UPD</strong> donde se deberán indicar las mismas y proceder a su actualización.</p>
<p>&nbsp;</p>
<h2>SIEM FixPack Updates</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar en el portal de IBM si existe alguna actualización pendiente para QRadar</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5 min</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Acceder al portal de <a href="https://www.ibm.com/support/fixcentral"><u>IBM Fix-Central</u></a> o <a href="https://www.ibm.com/community/qradar/home/software/"><u>IBM Software 101</u></a> y revisar si hay actualizaciones pendientes para QRadar.</p>
<p>En caso de haber alguna, abrir un ticket en RT con el tag FP_UPD para llevar el seguimiento de la actualización.</p>
<p>&nbsp;</p>
<h2>SIEM QDI</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar en el SIEM en la aplicación de QDI (QRadar Deployment Intelligence) si existen algún problema en la infraestructura</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>10 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Revisar si existen algún problema en el SIEM mediante la aplicación QDI, en caso de existir se deberá abrir un ticket con el tag <strong>INC </strong>indicando el problema descubierto y haciendo en el mismo el seguimiento de su resolución.</p>
<p>&nbsp;</p>
<h2>SIEM DSM</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar en el SIEM sí existen eventos unknown o stored.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5-60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>En caso de encontrar eventos unknown o stored se deberá crear un ticket con el tag <strong>DSMC </strong>en el cual se deberán documentar los mapeos realizados para la corrección de los eventos.</p>
<p>&nbsp;</p>
<h2>SIEM Log Source Groups</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisión de grupos de fuentes de log en el SIEM.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>5-60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción y el SIEM de desarrollo.</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>En caso de encontrar log sources que dispongan de grupos inválidos se deberá abrir un ticket con el tag <strong>CLS </strong>en el cual se documenten las modificaciones realizadas.</p>
<p>&nbsp;</p>
<h2>SIEM Rules Groups</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisión de los grupos de reglas actuales en el SIEM.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Mensual&nbsp;</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>60 minutos</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Se deberá revisar que las reglas existentes en producción dispongan de los grupos correspondientes en función del grupo de MAGMA al que pertenezcan, sección empresarial y tecnología de la regla.</p>
<p>En caso de que alguna no cumpla se deberá abrir un ticket con el tag <strong>CGR </strong>en el cual se indiquen los cambios realizados.</p>
<p>&nbsp;</p>
<h2>Security Platforms Updates</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Revisar si existe alguna nueva versión para los software utilizados en el departamento de seguridad.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semanal -&gt; Revisión de updates en las plataformas y sólo si existe una vulnerabilidad crítica se aplicará parche.</p>
<p>Trimestral -&gt; Revisión de updates en las plataformas y se actualizará hasta la última versión posible.</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>10 minutos</p>
<p>&nbsp;</p>
<h3><strong>Aplicaciones</strong></h3>
<p>Se deberá revisar si hay versiones nuevas para las siguientes aplicaciones:</p>
<ul>
  <li>IBM Soar</li>
  <li>IBM Soar App node</li>
  <li>Grafana</li>
  <li>MISP</li>
  <li>OpenCTI - Actualizar la excel <a href="https://docs.google.com/spreadsheets/u/0/d/165iGElFnuULC307HSUX30P9bbAB3gOG1Zm8rnPiZwBI/edit"><u>Opencti - Environments and containers</u></a></li>
  <li>OpenCVE - Actualizar la excel <a href="https://docs.google.com/spreadsheets/u/0/d/1ms_v1cClkvJvFyPQZj34tYkQPAwTNxKmnKjTjYqxiTs/edit"><u>OpenCVE - Environments and containers</u></a></li>
  <li>WikiJS - Actualizar la excel</li>
  <li>BitWarden ?</li>
</ul>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>En caso de existir una nueva versión para alguna de las aplicaciones utilizadas se deberá de abrir el ticket correspondiente para la gestión y seguimiento de su actualización.</p>
<p>Para la actualización de los contenedores de opencti revisar el documento <a href="https://wiki.security.espublico.com/es/home/sec/sto/platforms/opencti/instalacion-y-despliegue"><u>Instalación y despliegue</u></a></p>
<p>Para revisar las actualizaciones existentes en los contenedores de opencti:</p>
<ul>
  <li>Imágenes de servicios ajenos a opencti (redis, elastic…) buscar las imágenes OFICIALES en <a href="https://hub.docker.com"><u>https://hub.docker.com</u></a></li>
  <li>Para las imágenes de opencti, revisar la última versión en su <a href="https://github.com/OpenCTI-Platform/opencti"><u>github</u></a>. OJO: tanto el contenedor principal de opencti como todos los subcontenedores (workers, conectores, etc…) deben de estar en la misma versión.</li>
</ul>
<p>&nbsp;</p>
<h2>SIEM Change HA Active</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Cambio del nodo activo en los host que se encuentren en HA.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semestral</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>3 horas</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Se deberá revisar el SIEM de producción</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Para garantizar que tanto el nodo primario como el secundario funcionan correctamente, se deberá cambiar el nodo activo al nodo secundario en cada uno de los hosts montados en HA.</p>
<p>&nbsp;</p>
<h2>Update Servers</h2>
<p>&nbsp;</p>
<h3><strong>Descripción</strong></h3>
<p>Pasar setup en todos los servidores de seguridad.</p>
<p>&nbsp;</p>
<h3><strong>Recurrencia</strong></h3>
<p>Semestral</p>
<p>&nbsp;</p>
<h3><strong>Tiempo estimado</strong></h3>
<p>10 horas</p>
<p>&nbsp;</p>
<h3><strong>Servidores/Fuentes</strong></h3>
<p>Todos los servidores de seguridad</p>
<p>&nbsp;</p>
<h3><strong>Acciones</strong></h3>
<p>Para garantizar que los servidores de seguridad se encuentran al día y se corrigen las vulnerabilidades existentes hasta la fecha se deberá de pasar un setup completo en cada uno como mínimo una vez cada 6 meses.</p>
<p>&nbsp;</p>
