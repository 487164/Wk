<!--
title: Artifact & Memory Acquisition Process
description: 
published: true
date: 2024-02-01T11:03:54.793Z
tags: 
editor: ckeditor
dateCreated: 2024-01-30T13:04:23.200Z
-->

<h1>Definición</h1>
<p>Este proceso recoge los pasos a seguir para la adquisición de artefactos de los distintos sistemas operativos.</p>
<p>Para los entornos de puestos de usuarios, las herramientas no estarán disponible de forma local, en caso de incidente el equipo de respuesta dispondrá de las herramientas.</p>
<h1>Servidores Linux</h1>
<p>Para entornos de servidores linux, se dispone de las siguientes herramientas :</p>
<ul>
  <li>Memoria: AVML <a href="https://github.com/microsoft/avml">https://github.com/microsoft/avml</a></li>
  <li>Artefactos: CyLR <a href="https://github.com/orlikoski/CyLR">https://github.com/orlikoski/CyLR</a></li>
</ul>
<p>&nbsp;</p>
<h2>Antes de la adquisición</h2>
<p>Antes de ejecutar la herramienta es necesario verificar el tamaño de la memoria instalada en el servidor&nbsp;</p>
<pre><code class="language-plaintext">free -h</code></pre>
<p>A continuación, verificar que se dispone de almacenamiento suficiente para el volcado de memoria.</p>
<pre><code class="language-plaintext">df -h</code></pre>
<p>&nbsp;</p>
<h2>Adquisición completa</h2>
<p>Para hacer la adquisición, el binario se encuentra en el path /opt/scripts/ir<br>Como PATH le pasaremos la ruta donde tengamos suficiente espacio para el volcado.</p>
<pre><code class="language-plaintext">sudo ./opt/scripts/ir/uac -a artifacts/memory_dump/avml.yaml -p full {PATH}</code></pre>
<p>EN el path que le asignemos se generará 2 ficheros, las evidencias comprimidas y el log.</p>
<h2>Adquisición solo de artefactos</h2>
<p>Para una adquisición sin memoria, ejecutar el siguiente comando:</p>
<pre><code class="language-plaintext">sudo ./opt/scripts/ir/uac -p full {PATH}</code></pre>
<h2>Exportar evidencias</h2>
<p>Dependiendo del tamaño y el contexto, estas pueden extraerse mediante scp, SFTP o S3.</p>
<p>&nbsp;</p>
<h1>Servidores Windows</h1>
<p>Para entornos de servidores Windows, se dispone de la herramienta KAPE</p>
<p><a href="https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape">https://www.kroll.com/</a></p>
<h2>Antes de la adquisición</h2>
<p>Antes de ejecutar la herramienta es necesario verificar el tamaño de la memoria instalada en el servidor&nbsp;</p>
<pre><code class="language-plaintext">(Get-CimInstance Win32_PhysicalMemory | Measure-Object -Property capacity -Sum).sum /1gb</code></pre>
<p>A continuación, verificar que se dispone de almacenamiento suficiente para el volcado de memoria.</p>
<pre><code class="language-plaintext">Get-CimInstance -ClassName Win32_LogicalDisk `
| Select-Object -Property DeviceID,@{'Name' = 'FreeSpace (GB)'; Expression= { [int]($_.FreeSpace / 1GB) }}</code></pre>
<p>Verificar que la ruta C:\app existe.</p>
<h2>Adquisición completa</h2>
<p>Para hacer la adquisición, el binario se encuentra en el path C:\app\kape<br>Abrir un CMD como administrador y ejecutar el fichero bat</p>
<pre><code class="language-plaintext">C:\app\kape\adquisicion-espublico.bat</code></pre>
<p>&nbsp;</p>
<h2>Adquisición de artefactos</h2>
<p>Para hacer la adquisición, el binario se encuentra en el path C:\app\kape<br>Abrir un CMD como administrador y ejecutar el fichero bat</p>
<pre><code class="language-plaintext">C:\app\kape\adquisicion-artefactos.bat</code></pre>
<p>&nbsp;</p>
<h2>Adquisición de memoria</h2>
<p>Para hacer la adquisición, el binario se encuentra en el path C:\app\kape<br>Abrir un CMD como administrador y ejecutar el fichero bat</p>
<pre><code class="language-plaintext">C:\app\kape\adquisicion-memoria.bat</code></pre>
<p>&nbsp;</p>
<h2>Exportar evidencias</h2>
<p>Dependiendo del tamaño y el contexto, estas pueden extraerse mediante RDP, scp, SFTP o S3.</p>
<h1>&nbsp;</h1>
