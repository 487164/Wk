<!--
title: AO-LAT-001 [MEDIA] [ESPUBLICO] [MULTI] Sospechosos inicios de sesion con el mismo usuario en varios dispositivos
description: 
published: true
date: 2024-01-23T11:43:13.743Z
tags: 
editor: ckeditor
dateCreated: 2024-01-22T12:22:55.985Z
-->

<h1 style="text-align:center;">AO-LAT-001 [MEDIA] [ESPUBLICO] [MULTI] Sospechosos inicios de sesion con el mismo usuario en varios dispositivos</h1>
<h2>Descripción</h2>
<p style="text-align:justify;">Este caso de uso identifica los casos sospechosos de inicios sesión con el mismo usuario en varios dispositivos estos eventos tienen que ser detectados por MySQL Audit, los usuario no tienen que estar en una whitelist ni ser el root, para que salte la alerta tienen que detectar 10 eventos con el mismo nombre de usuario y diferente fuente de registro en 5 minutos.</p>
<ul>
  <li><strong>Nombre</strong>: Sospechosos inicios de sesión con el mismo usuario en varios dispositivos</li>
  <li><strong>Criticidad</strong>: Media</li>
  <li><strong>Tiempo de Atención</strong>: 90 minutos</li>
  <li><strong>Tecnologías utilizadas</strong>: Logs Locales</li>
</ul>
<h2>MITRE</h2>
<ul>
  <li>TA0004 - Privilege Escalation</li>
  <li>TA0002 - Execution<ul>
      <li>T1059 - Command and Scripting Interpreter</li>
    </ul>
  </li>
</ul>
<h2>What to do</h2>
<p style="text-align:justify;">Después de un Login correcto en al menos 10 dispositivos en un periodo de 5 minutos, tendremos que revisar si se ha logueado usando su clave pública y comprobamos que la IP de origen le pertenece en IPAM para corroborar que es dicho usuario.</p>
<p style="text-align:justify;">También tendremos que revisar las acciones de dichos usuarios, analizando su actividad y comandos introducidos para averiguar a qué se debe el acceso a un gran número de dispositivos.</p>
<p style="text-align:justify;">En caso de ser una actividad esperada por el usuario, revisaremos en RT si tiene algún Ticket al que le haga referencia y lo definiríamos como FP descartando un incidente de seguridad, y proporcionando la nota de cierre correspondiente con la investigación realizada.</p>
<h2>Notas de cierre</h2>
<p>Puntos mínimos que debe de tener un cierre:</p>
<ul>
  <li>Usuario que ha accedido a diferentes máquinas en un plazo reducido de tiempo</li>
  <li>Veracidad del acceso</li>
  <li>Acciones realizadas</li>
  <li>Seguimiento posterior de la actividad del usuario</li>
  <li>Resumen del análisis</li>
</ul>
<h2>Matriz de escalado</h2>
<p style="text-align:justify;">Aunque la matriz de escalado debería ser la misma para todos los casos de uso, puede haber casos que por falta de capacidades, por dependencias de otros servicio o incluso por que así se acuerde para un caso concreto, se debe definir la matriz de escalado.</p>
<p style="text-align:justify;">En horario laboral: Atiende N1 y escala a N2</p>
<p style="text-align:justify;">Fuera del horario Atiende N0 y escala a Guardia</p>
<h2>Reglas de caso de uso</h2>
<figure class="image image_resized" style="width:669px;"><img src="https://lh7-eu.googleusercontent.com/Lz4EdI20Q_kLwxteM0cyFBGPVt8MJMVc8HRW6EJSgrb5yRmQUuh0NzJG_YsXcawd9UoZUdp6ayaO1pha9WccgZNhS6JmNx7oCl1OYGzva3G8wvfca-jPUke_K0RZUMXchUozu1fjz724"></figure>
<figure class="image image_resized" style="width:675px;"><img src="https://lh7-eu.googleusercontent.com/s9SNyXyBVBxDAtItF2IWaLywTr6L3QVVPHqiUNm2tknPHA-FDvne0KRczGGmy4rTC3vSfnD5aTeYVcNxTzwe6Ud2CGUMA8xMvjoyUj00yjXHa1VA-6Q6NgVBfMInO9LJT9suGHn17sbn"></figure>
<h2>Campos Necesarios&nbsp;</h2>
<p>Los campos mínimos que deben seleccionarse para llevar a cabo la investigación:</p>
<ul>
  <li>Start Time</li>
  <li>Username</li>
  <li>Command (custom)</li>
  <li>Machine identifier (custom)</li>
  <li>Source IP</li>
  <li>Event Count</li>
</ul>
<h2>Cierre por defecto</h2>
<p>Nota de cierre que se debería de rellenar a la hora de cerrar una alerta:</p>
<p>Falso positivo:</p>
<ul>
  <li>Se observa que el usuario [<strong>Username</strong>] se conecta desde su IP [<strong>Source IP</strong>] y se conecta con el Warrior con su clave pública, tras ver que las peticiones que realiza son comandos verídicos y que las actividades realizadas son legítimas y registradas en el Ticket de RT&nbsp; [<strong>Nº de ticket al que corresponde la tarea realizada</strong>] se cierra la alerta como Falso Positivo.</li>
</ul>
<p>Falso positivo con ajuste:</p>
<ul>
  <li>Se observa que el usuario [<strong>Username</strong>] se conecta desde su IP [<strong>Source IP</strong>] y se conecta con el Warrior con su clave pública, tras ver que las peticiones que realiza son comandos verídicos y que las actividades realizadas son legítimas y registradas en el Ticket de RT&nbsp; [<strong>Nº de ticket al que corresponde la tarea realizada</strong>]. Sin embargo se localizara un fallo en la regla, en la que [<strong>Descripción del fallo o ajuste necesario</strong>], y se abriría ticket en “<a href="https://soporte.iubaris.com/"><u>https://soporte.iubaris.com/</u></a>” (RT) con numero [<strong>Nº de ticket abierto</strong>].</li>
</ul>
<p>Positivo:</p>
<ul>
  <li>Se observa que el usuario [<strong>Username</strong>] se conecta con el Warrior con su clave pública, tras ver que las peticiones que realiza son comandos y que las actividades realizadas [<strong>Actividad realizada por el usuario pudiendo ser descargas/subidas o modificación</strong>] son perjudiciales, se realiza una revisión de los Ticket de RT para identificar una posible justificación quedando confirmado que la actividad por el usuario no es legítima</li>
</ul>
