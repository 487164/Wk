<!--
title: AO-ACC-012 [MEDIA] [MULTI] [Google] Workspace Posible cuenta comprometida
description: 
published: true
date: 2024-01-24T09:17:01.192Z
tags: 
editor: ckeditor
dateCreated: 2024-01-22T11:56:32.392Z
-->

<h1 style="text-align:center;">AO-ACC-012 [MEDIA] [MULTI] [Google] Workspace Posible cuenta comprometida</h1>
<h2>Descripción</h2>
<p>Este caso de uso identifica una posible cuenta comprometida de Google G Suite, detectando al menos dos eventos de login desde diferentes direcciones IP.</p>
<ul>
  <li><strong>Nombre</strong>: Google Workspace Posible Cuenta Comprometida</li>
  <li><strong>Criticidad</strong>: Media</li>
  <li><strong>Tiempo de Atención</strong>: 90 minutos</li>
  <li><strong>Tecnologías utilizadas</strong>: Google WorkSpace</li>
</ul>
<h2>MITRE</h2>
<ul>
  <li>TA0006 - Credential Access.</li>
  <li>TA0007 - Discovery.</li>
  <li>TA0001 - Initial Access.</li>
</ul>
<h2>What to do</h2>
<p style="text-align:justify;">Una vez identificado el usuario que posiblemente haya sido comprometido, deberá revisarse desde qué direcciones IP y país se han realizado los Login.</p>
<p style="text-align:justify;">En QRadar hay dos QID que hacen referencia al login de los usuarios con el <i>log source</i> de “Google Workspace”:</p>
<ul>
  <li>QID: 112.500.174 (Login del usuario)</li>
  <li>QID: 112.500.175 (Validación con 2FA)</li>
</ul>
<p style="text-align:justify;">Si ha fallado en la autenticación por 2FA podrá verse en el payload lo siguiente:</p>
<p style="text-align:center;"><i>{"name":"login_challenge_status","value":"incorrect_answer_entered"}</i></p>
<p style="text-align:justify;">Si ha hecho la autenticación por 2FA correctamente se verá en el payload lo siguiente:</p>
<p style="text-align:center;"><i>{"name":"login_challenge_status","value":"passed"}</i></p>
<p style="text-align:justify;">De esta forma, podrá comprobarse si ha habido un robo de credenciales, pero por el contrario no contaban con el 2FA para acceder a la cuenta.</p>
<p style="text-align:justify;">Deberá ponerse en contacto con el usuario propietario de la cuenta para verificar si ha sido él y el motivo por el que se han registrado dos direcciones IP distintas.</p>
<p style="text-align:justify;">En caso de que el usuario confirme que es consciente de dichos intentos de logins, lo definiríamos como FP descartando un incidente de seguridad y proporcionando la nota de cierre correspondiente con la investigación realizada.</p>
<h2>Notas de cierre</h2>
<p>Puntos mínimos que debe de tener un cierre</p>
<ul>
  <li>Posible cuenta comprometida</li>
  <li>Fecha / Hora de los Login sospechosos</li>
  <li>Dirección IP donde se han producido los Login</li>
  <li>Geolocalización de dichas IP</li>
  <li>Resumen del análisis</li>
</ul>
<h2>Matriz de escalado</h2>
<p style="text-align:justify;">Aunque la matriz de escalado debería ser la misma para todos los casos de uso, puede haber casos que por falta de capacidades, por dependencias de otros servicio o incluso por que así se acuerde para un caso concreto, se debe definir la matriz de escalado.</p>
<p>En horario laboral: Atiende N1 y escala a N2</p>
<p>Fuera del horario Atiende N0 y escala a Guardia</p>
<h2>Reglas de caso de uso</h2>
<figure class="image image_resized" style="width:68.71%;"><img src="https://lh7-eu.googleusercontent.com/9RAEEzaA3S0TIpgJHzFO82mNXB-ZBzBnhP7Uc1GblkolHhs_UkWKhvMJrg8mjCCsfCo5KvM_a9DyrCxuU95Oo-_JJBuDL5oycpc9OSzdytN2-MYGKBg5sXjKSx5T-EPZ-316WwCh2quu"></figure>
<h2>Campos Necesarios</h2>
<p>Los campos mínimos que deben seleccionarse para llevar a cabo la investigación:</p>
<ul>
  <li>Start Time</li>
  <li>Event Name</li>
  <li>Source IP</li>
  <li>Username</li>
  <li>Event Count</li>
</ul>
<h2>Cierre por defecto</h2>
<p>Nota de cierre que se debería de rellenar a la hora de cerrar una alerta:</p>
<p><strong>Falso positivo:</strong></p>
<ul>
  <li>Se han detectado que el usuario [<strong>Username</strong>]&nbsp; se ha logueado desde diferentes ubicaciones, en las cuales sería imposible desplazarse utilizando el tiempo entre conexiones, por lo que se han analizado las IPs de origen que nos muestra la alerta, y al usuario en Azure, también se verifica si ha habido MFA y la ubicación de sus conexiones sin encontrar nada sospechoso, se determina que ha habido un fallo en la geolocalización del usuario.</li>
</ul>
<p><strong>Falso positivo con ajuste:</strong></p>
<ul>
  <li>Se han detectado que el usuario [<strong>Username</strong>]&nbsp; se ha logueado desde diferentes ubicaciones, en las cuales sería imposible desplazarse utilizando el tiempo entre conexiones, por lo que se han analizado las IPs de origen que nos muestra la alerta, y al usuario en Azure, también se verifica si ha habido MFA y la ubicación de sus conexiones sin encontrar nada sospechoso, se determina que ha habido un fallo en la geolocalización del usuario, sin embargo se localiza un&nbsp; fallo en la regla en la que [<strong>Descripción del ajuste necesario</strong>], por lo cual se abre ticket en “<a href="https://soporte.iubaris.com/"><u>https://soporte.iubaris.com/</u></a>” (RT) con número [<strong>Nº de ticket abierto</strong>].</li>
</ul>
<p><strong>Positivo:</strong></p>
<ul>
  <li>Se han detectado que el usuario [<strong>Username</strong>]&nbsp; se ha logueado desde diferentes ubicaciones, en las cuales sería imposible desplazarse utilizando el tiempo entre conexiones, por lo que se han analizado las IPs de origen que nos muestra la alerta, así mismo se comprueba la actividad del usuario en Azure, determinando que la cuenta del usuario ha sido comprometido siendo utilizada por otra persona.</li>
</ul>
