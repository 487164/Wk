<!--
title: EX-BRU-007 [MEDIA] [Gestiona] Posible Fuerza bruta contra Gestiona con el mismo usuario
description: 
published: true
date: 2024-01-23T12:38:07.262Z
tags: 
editor: ckeditor
dateCreated: 2024-01-23T12:38:07.262Z
-->

<h1 style="text-align:center;">EX-BRU-007 [MEDIA] [Gestiona] Posible Fuerza bruta contra Gestiona con el mismo usuario</h1>
<h2>Descripción</h2>
<p style="text-align:justify;">Este caso de uso identifica múltiples fallos de autenticación que derivaran al bloqueo del acceso (QID “1005750029” LOGIN_ACCESS_BLOCKED), para que al usuario se le bloquee el acceso debe fallar 5 veces las credenciales y para que salte la alerta debe fallar mínimo otras 5 veces más en un plazo de 10 minutos, los eventos no procedan de la red de origen es&nbsp; "esPublico-zgz-public.BB-esPublicoGroup-Salidas-oficina2”.&nbsp;</p>
<ul>
  <li><strong>Nombre</strong>: Posible Fuerza bruta contra Gestiona con el mismo usuario</li>
  <li><strong>Criticidad</strong>: Media</li>
  <li><strong>Tiempo de Atención</strong>: 90 minutos</li>
  <li><strong>Tecnologías utilizadas</strong>: Logs locales</li>
</ul>
<h2>MITRE</h2>
<ul>
  <li>TA0006 – Credential Access.</li>
  <li>TA0007 - Discovery.</li>
  <li>TA0008 Latereal Movement</li>
  <li>T1021 Remote Services<ul>
      <li>T1021.004 SSH</li>
    </ul>
  </li>
</ul>
<p>&nbsp;</p>
<h2>What to do</h2>
<p style="text-align:justify;">Se debe revisar principalmente la IP de origen y de destino, prestando especial hincapié en la de origen para verificar si pertenece a esPublico, y analizarla, en caso de que no pertenezca a espublico, habría que analizarla para saber si es maliciosa, también tendríamos que localizar el DNI en el campo "user_dni (custom)" o en el payload "user.dni":"XXXXXXXX", tendríamos que localizar al usuario afectado (siendo este identificado por el campo "user.name" y por el "DNI" ) para verificar si los intentos de logueo son verídicos, después revisaremos que el campo ""login_attempt (custom)" tenga un valor de 10 o superior, e indicar el valor del evento más reciente (es un número incremental por lo que tiene que ser el del último evento producido&nbsp; para que sea el real).</p>
<p style="text-align:justify;">si son intentos verídicos se cierra como Falso Positivo.</p>
<p style="text-align:justify;">Si los intentos de logueo no son verídicos y la IP de origen es ajena a "esPublico" tendremos que escalar la alerta indicando todo lo analizado en la nota para que incluyan la IP en el reference set para su bloqueo.</p>
<h2>Notas de cierre</h2>
<p>Puntos mínimos que debe de tener un cierre</p>
<ul>
  <li>Análisis de la IP de origen</li>
  <li>Análisis de la IP de destino</li>
  <li>DNI y nombre del usuario</li>
  <li>Valor del campo "login_attempt (custom)" en el último evento</li>
  <li>Fecha/Hora del inicio y final del ataque</li>
  <li>Indicar si en incidente ha sido causado por el usuario después de haberlo corroborado con el.</li>
</ul>
<h2>Matriz de escalado</h2>
<p style="text-align:justify;">En esta alerta, el escalado se realizaría si después de terminar la investigación ya sea por falta de conocimientos o por sucesos sospechosos que se hayan visto no se pueda descartar un posible incidente de seguridad, o como en este caso que la IP de origen sea externa a "esPublico-zgz-public.BB-esPublicoGroup-Salidas-oficina2”.</p>
<p style="text-align:justify;">Dependiendo del horario en que nos encontremos el escalado será distinto:</p>
<p style="text-align:justify;">En horario laboral: Atiende en primera instancia N1 y si es necesario escalar, pasaría a N2.</p>
<p style="text-align:justify;">Fuera del horario Atiende el técnico de 24/7 que se encuentre y en caso necesario escalaría a Guardia ya que al ser una alerta ALTA se podría dar un incidente de seguridad.</p>
<h2>Reglas de caso de uso</h2>
<p style="text-align:justify;">A continuación se muestran las reglas que tienen que darse para que salte la alerta:</p>
<figure class="image image_resized" style="width:78.79%;"><img src="https://lh7-eu.googleusercontent.com/kwA2l0cUA9eT4zfLC7fpSr4K0AJIpwkrVD4JmS12mgzGDAVuvLFtvZuZSUJscz3Q1RY5xJw2lEfNHkrhdh0nXLdHl9UQJmCa6tRg0Ug-BrGo9UYEhAmtHun8XJ2UjMvE66uFiYgUa16_D_-_N3arOag"></figure>
<h2>Campos Necesarios</h2>
<p>Los campos mínimos que deben seleccionarse para llevar a cabo la investigación:</p>
<ul>
  <li>Start Time</li>
  <li>user_dni (custom)</li>
  <li>organization_id (custom)</li>
  <li>Source IP</li>
  <li>Destination IP</li>
  <li>Event Count</li>
</ul>
<h2>Cierre por defecto</h2>
<p>Nota de cierre que se debería de rellenar a la hora de cerrar una alerta:</p>
<p><strong>Falso positivo:</strong></p>
<ul>
  <li>Se ha detectado un posible ataque de Fuerza Bruta, desde la IP [<strong>Source IP</strong>] hacia la IP [<strong>Destiny IP</strong>] y del usuario<strong> </strong>[<strong>Username</strong>], la alerta comenzó [<strong>Start Time</strong>], después de analizar los diferentes elementos de la alerta, se determina que el usuario fue bloqueado por múltiples fallos de autenticación incorrectos y aun asi intento logarse provocando el salto de la alerta, después del análisis del usuario, su actividad y la IP de origen se consideran fallos verídicos.</li>
</ul>
<p><strong>Falso positivo con ajuste:</strong></p>
<ul>
  <li>Se ha detectado un posible ataque de Fuerza Bruta, desde la IP [<strong>Source IP</strong>] hacia la IP [<strong>Destiny IP</strong>] y del usuario<strong> </strong>[<strong>Username</strong>], la alerta comenzó [<strong>Start Time</strong>], después de analizar los diferentes elementos de la alerta, se determina que el usuario fue bloqueado por múltiples fallos de autenticación incorrectos y aun asi intento logarse provocando el salto de la alerta, después del análisis del usuario, su actividad y la IP de origen se consideran fallos verídicos, sin embargo se localiza un&nbsp; fallo en la regla en la que [<strong>Descripción del ajuste necesario</strong>], por lo cual se abre ticket en “<a href="https://soporte.iubaris.com/"><u>https://soporte.iubaris.com/</u></a>” (RT) con número [<strong>Nº de ticket abierto</strong>].</li>
</ul>
<p><strong>Positivo contenido:</strong></p>
<ul>
  <li>Se ha detectado un ataque de Fuerza Bruta, desde la IP [<strong>Source IP</strong>] hacia la IP [<strong>Destiny IP</strong>], usando el usuario<strong> </strong>[<strong>Username</strong>], la alerta comenzó [<strong>Start Time</strong>], muestra cómo el usuario fue bloqueado por múltiples fallos de autenticación incorrectos y aun asi intento logarse provocando el salto de la alerta, [<strong>Análisis de el usuario como la IP de origen</strong>] y la cantidad de intentos se concluye que fue un ataque por fuerza bruta sin éxito .</li>
</ul>
<p><strong>Positivo:</strong></p>
<ul>
  <li>Se ha detectado un ataque de Fuerza Bruta, desde la IP [<strong>Source IP</strong>] hacia la IP [<strong>Destiny IP</strong>], usando el usuario<strong> </strong>[<strong>Username</strong>], la alerta comenzó [<strong>Start Time</strong>], muestra cómo el usuario fue bloqueado por múltiples fallos de autenticación incorrectos y aun asi intento logarse provocando el salto de la alerta, [<strong>Análisis de el usuario como la IP de origen</strong>] y la cantidad de intentos se concluye que tuvieron éxito en este ataque por fuerza bruta.</li>
</ul>
