<!--
title: EX-BRU-005 [BAJA] [ESPUBLICO] [WINLOGON] Múltiples fallos de autenticación local en servidores Windows
description: 
published: true
date: 2024-01-23T12:52:50.822Z
tags: 
editor: ckeditor
dateCreated: 2024-01-23T12:52:50.822Z
-->

<h1 style="text-align:center;">EX-BRU-005 [BAJA] [ESPUBLICO] [WINLOGON] Múltiples fallos de autenticación local en servidores Windows</h1>
<h2>Descripción</h2>
<p style="text-align:justify;">Este caso de uso identifica fallos de autenticación en PhpMyAdmin, y generará la alerta cuando se produzcan 5 fallos en una hora.</p>
<ul>
  <li><strong>Nombre</strong>: Múltiples fallos de autenticación local en servidores Windows</li>
  <li><strong>Criticidad</strong>: Baja</li>
  <li><strong>Tiempo de Atención</strong>: 180 minutos</li>
  <li><strong>Tecnologías utilizadas</strong>: Microsoft Windows Security Event Log</li>
</ul>
<h2>MITRE</h2>
<ul>
  <li>TA0006 - Credential Access</li>
  <li>T1110 - Brute Force</li>
  <li>TA0007 - Discovery</li>
</ul>
<h2>What to do</h2>
<p style="text-align:justify;">Se debe identificar al usuario que está generando eventos, y desde qué dirección IP, comprobando en IPAM que está asignada al rango de IPs del usuario. También se deberá comprobar en IPAM el nombre de la máquina correspondiente a la IP de destino contra la que se está intentando autenticar</p>
<p style="text-align:justify;">En los eventos se deberá comprobar el código de error de kerberos, para saber por qué se ha generado el evento (cuenta bloqueada, contraseña errónea, usuario erróneo, etc.). Cuando se dejen de generar eventos, habrá que averiguar a qué se deben, cese de actividad, contraseña introducida correctamente, etc.</p>
<h2>Notas de cierre</h2>
<p>Puntos mínimos que debe de tener un cierre:</p>
<ul>
  <li>Fecha / Hora</li>
  <li>IP de origen</li>
  <li>IP de destino</li>
  <li>Usuario que ha generado los fallos</li>
  <li>Acciones</li>
</ul>
<h2>Matriz de escalado</h2>
<p style="text-align:justify;">Aunque la matriz de escalado debería ser la misma para todos los casos de uso, puede haber casos que por falta de capacidades, por dependencias de otros servicio o incluso por que así se acuerde para un caso concreto, se debe definir la matriz de escalado.</p>
<p style="text-align:justify;">En horario laboral: Atiende en primera instancia N1 y si es necesario escalar, pasaría a N2.</p>
<p style="text-align:justify;">Fuera del horario Atiende el técnico de 24/7 que se encuentre y escalara después del análisis inicia a Guardia ya que hay que ponerse en contacto con terceros para una correcta resolución.</p>
<h2>Reglas de caso de uso</h2>
<figure class="image image_resized" style="width:85.02%;"><img src="https://lh7-eu.googleusercontent.com/hDFUnRIJIJs_H9ofZludB9-fwWab9xUcHXuauJxKs5ZeRWaEkujAk-2rEanJDIfKiTzzo9KGhPwKOvwDQYi9CD8cSgJTafFWrHfBWhqKTAeXwxvrtCDiORDe1Wcr5ogWEPtVGIkpMB_p"></figure>
<h2>Campos Necesarios</h2>
<p style="text-align:justify;">Los campos mínimos que deben seleccionarse para llevar a cabo la investigación:</p>
<ul>
  <li>Start Time</li>
  <li>Event Name</li>
  <li>Username</li>
  <li>Source IP</li>
  <li>Kerberos_error_code (custom)</li>
</ul>
<h2>Cierre por defecto</h2>
<p>Nota de cierre que se debería de rellenar a la hora de cerrar una alerta:</p>
<p><strong>Falso positivo 1:</strong></p>
<ul>
  <li>Se han detectado múltiples fallos de autenticación con el usuario [<strong>Username</strong>] desde la IP [<strong>Source IP</strong>] hacia la dirección [<strong>Destination IP</strong>] la cual pertenece a la máquina [<strong>Machine Identifier</strong>]. Después de analizar los eventos, se llega a la conclusión de que son intentos de acceso controlados, por lo que se descarta el incidente de seguridad.</li>
</ul>
<p><strong>Falso positivo 2:</strong></p>
<ul>
  <li>Se han detectado múltiples fallos de autenticación con el usuario [<strong>Username</strong>] desde la IP [<strong>Source IP</strong>] hacia la dirección [<strong>Destination IP</strong>] la cual pertenece a la máquina [<strong>Machine Identifier</strong>]. Después de analizar los eventos, se llega a la conclusión de que los eventos son generados debido a que la contraseña del usuario se encuentra cacheada, y al ser distinta a su contraseña actual, la detecta como errónea, pero no se ha producido ningún incidente de seguridad.</li>
</ul>
<p><strong>Falso positivo con ajuste:</strong></p>
<ul>
  <li>Se han detectado múltiples fallos de autenticación con el usuario [<strong>Username</strong>] desde la IP [<strong>Source IP</strong>] hacia la dirección [<strong>Destination IP</strong>] la cual pertenece a la máquina [<strong>Machine Identifier</strong>]. Después de analizar los eventos, se llega a la conclusión de que son intentos de acceso controlados, sin embargo se localiza un&nbsp; fallo en la regla en la que [<strong>Descripción del ajuste necesario</strong>], por lo cual se abre ticket en “<a href="https://soporte.iubaris.com/"><u>https://soporte.iubaris.com/</u></a>” (RT) con número [<strong>Nº de ticket abierto</strong>].</li>
</ul>
<p><strong>Positivo:</strong></p>
<ul>
  <li>Se han detectado múltiples fallos de autenticación con el usuario [<strong>Username</strong>] desde la IP [<strong>Source IP</strong>] hacia la dirección [<strong>Destination IP</strong>] la cual pertenece a la máquina [<strong>Machine Identifier</strong>]. Después de analizar los eventos, se llega a la conclusión de que los accesos no están siendo realizados por el usuario y no están controlados, por lo que se ha producido un incidente de seguridad,</li>
</ul>
